#ACCEPT_OVERRIDE = '*'
ACCEPT_OVERRIDE = null
DEBUG = false

exports = window

assert = (exp) ->
  throw 'Runtime error' unless exp

p = (exp) ->
  console.log(exp)

_next_id = 1

exports.Card = Ember.Object.extend
  id: (->
    @_id ||= _next_id++
    "id#{@id}"
  ).property()
  rank: null
  suit: null

exports.CardController = Ember.Object.extend
  model: null

  idBinding: 'model.id'
  rankBinding: 'model.rank'
  suitBinding: 'model.suit'

exports.CardView = Ember.View.extend
  templateName: 'templates/card'

  controller: null
  model: (->
    controller.model # binding? deps insufficient
  ).property 'controller'

  idBinding: 'controller.id'
  rankBinding: 'controller.rank'
  suitBinding: 'controller.suit'

  idAttr: (->
    "card_#{@get 'id'}"
  ).property 'id'
  classAttr: (->
    "card card_#{@get 'rank'}_#{@get 'suit'}"
  ).property 'rank', 'suit'
  styleAttr: (->
    "background-position: -#{@rank * 79}px -#{_(['clubs', 'diamonds', 'hearts', 'spades']).indexOf(@suit) * 123}px;"
  ).property 'rank', 'suit'

exports.ApplicationView = Ember.View.extend
  templateName: 'templates/application'

  myOneCardView: null

exports.setup_game = ->
  $ ->
    rootElement = '#solitaire-canvas'
    window.App = Ember.Application.create
      rootElement: rootElement
    v = CardView.create
      controller: CardController.create
        model: Card.create
          rank: 5
          suit: 'diamonds'
    v.appendTo(rootElement)
